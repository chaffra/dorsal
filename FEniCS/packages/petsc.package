NAME=petsc-3.2-p6
SOURCE=http://ftp.mcs.anl.gov/pub/petsc/release-snapshots/
PACKING=.tar.gz
BUILDCHAIN=autotools

CONFOPTS="COPTFLAGS=-O2
        --with-debugging=0 --with-shared-libraries=1 --with-clanguage=cxx
        --with-parmetis=1 --with-parmetis-dir=${PARMETIS_DIR}"

for external_pkg in umfpack hypre mumps scalapack blacs ptscotch scotch; do
    CONFOPTS="${CONFOPTS} --download-${external_pkg}=1"
done

if [ "${TRILINOS_DIR}" ]; then
    CONFOPTS="${CONFOPTS} --with-ml=1
              --with-ml-lib=${TRILINOS_DIR}/lib/libml.so
              --with-ml-include=${TRILINOS_DIR}/include/trilinos"
fi

if [ "${CUDA_DIR}" ] && [ "${CUSP_DIR}" ]; then
    CONFOPTS="${CONFOPTS} --with-cuda=1 --with-cuda-dir=${CUDA_DIR}
    --with-cusp=1 --with-cusp-dir=${CUSP_DIR}
    --with-thrust=1 --with-thrust-dir=${CUDA_DIR}/include"
fi

package_specific_setup () {
    patch -p1 --forward < ${ORIG_DIR}/FEniCS/patches/petsc.patch || true
    export PETSC_DIR=${PWD}
}

package_specific_register () {
    export PETSC_DIR=${INSTALL_PATH}
    unset PETSC_ARCH
}
